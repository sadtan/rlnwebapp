<%- include('../partials/header') -%>

<div class="container pag-pieza">
  <% 
  pieza = data.data['piezas'][0];
  creador = pieza['dep']['creador'][0]
  descriptores = pieza['descriptores'].split(", ");
  hecho = pieza['dep']['hecho'][0]

  //console.log('pieza', pieza);
  %>
  <!-- Imagen del fondo -->
  <section class="section-fondo img-fondo top">
    <img class="s3_img" src="<%=pieza['imagen_path']%>">
  </section>

  <!-- Titulo y datos básicos -->
  <section class="half-top section-fondo intro-pieza">
    <h2>
      <%=pieza['titulo']%>  
      (<%=pieza['fecha']%>)
    </h2>
    <p class="italic"> 
      <%=creador['nombre']%>  
    </p> 

    <ul class="datos-basicos">
      <li><b> Autoras: </b> <%=pieza['autores']%></li>
      <li><b> Temáticas: </b> <%=pieza['tematicas']%></li>
      <li><b> Técnicas: </b> <%=pieza['tecnicas']%></li>
      <li><b> Materiales: </b><%=pieza['materiales']%></li>
      <li><b> Dimensiones: </b> 
        <%=pieza['ancho']%> x
        <%=pieza['alto']%> x
        <%=pieza['espesor']%>
      </li>
    </ul>
  </section>

  <section class="section-fondo top">
    <div class="row ">
      <div class="col col-12 col-md-6 detalle-piezas" >
        <div class="row sticky-top ">
            <% for(var i = 0; i < descriptores.length; i++) { %>
              <%if (pieza['galeria'][i]) {  %>
                
            <div class="col col-6 detalle detalle-modal">
              <a>
                  <img class="s3_img" src="<%=pieza['galeria'][i]%>">
                
                <div class="blue"></div>
              </a>
            </div>
            <% } %>
            <% } %>
            <ul class="descriptores lista btm">
              <% for(var i = 0; i < descriptores.length; i++) { %>
                <li class="descriptor-li"> <%=descriptores[i]%> </li>
              <% } %>
            </ul>
            <form action="/buscar" method="POST" id="descriptor-form" style="display: none;">
              <input type="text" name="descriptor" id="descriptor-field">
            </form>
        </div>
      </div>
      <script>
        var docDescList = document.getElementsByClassName("descriptor-li");
        var descForm = document.getElementById("descriptor-form");
        var descInput = document.getElementById("descriptor-field");

        var descList = [];

        for (let i = 0; i < docDescList.length; ++i)
        {
          docDescList[i].addEventListener("click", function()
          {
            descInput.value = docDescList[i].innerText.toLowerCase();
            descForm.submit();
          })
        }
      </script>

      <div class="col-12 col-md-6">
          <h2>
            Cómo se hizo
          </h2>
          <p>
            <%=pieza['relato_pieza']%>
          </p>

          <h2 class="half-top">
            Qué nos cuenta
          </h2>
          <ul class="hecho">
            <li><b> Año: </b> <%=hecho['fecha']%></li>
            <li><b> Modalidad: </b> <%=hecho['modalidad']%></li>
            <li><b> Actores: </b> <%=hecho['actores']%></li>
          </ul>

          <p>
            <%=pieza['hecho_relato']%>
          </p>

          <h2>
            Trayectoria
          </h2>
          <p>
            <%=pieza['usos']%>
          </p>

          <h2>
            Conservación
          </h2>
          <p>
            <%=pieza['conservacion']%>
          </p>

          <h2>
            Eventos
          </h2>
          <p>
            <ul>
            <%var eventos = JSON.parse(pieza['eventos_json'].replace(/(\r\n|\n|\r|')/gm, '"'))['obj']
            //console.log(eventos)
            for (let i = 0; i < eventos.length; ++i)
            {
              var evento = eventos[i]
           
            
            %>
            <li> 
              <p> <%=evento['name']%>,<%=evento['place']%>,<%=evento['date']%> </p>
            </li>
      
            <% } %>
            
          </ul>

          <h2>
            Documentos
          </h2>
          <p>
            <ul>
            <%var documentos = JSON.parse(pieza['documentos_json'].replace(/(\r\n|\n|\r|')/gm, '"'))['obj']
            console.log(documentos)
            for (let i = 0; i < documentos.length; ++i)
            {
              var documento = documentos[i]
           
            
            %>
            <li> 
              <a target="_blank" href="<%=documento['url']%>"> <%=documento['name']%></a> </li>
            </li>
      
            <% } %>
            
          </ul>
      </div>
    </div>
  </section>

  <div class="modal">
    <div class="modal-background"></div>
    <div class="modal-content"></div>   
    <div class="modal-close">Cerrar</div>   
  </div>

</div>
<script src="/scripts/s3ImageUrl.js"></script>
<script src="/scripts/modal.js"></script>
<%- include('../partials/footer') -%>
