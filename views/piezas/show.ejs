<%- include('../partials/header') -%>

<div class="container pag-pieza">
  <% 
  pieza = data.data['piezas'][0];
  creador = pieza['dep']['creador'][0]
  descriptores = pieza['descriptores'].split(", ");
  hecho = pieza['dep']['hecho'][0]

  //console.log('pieza', pieza);
  %>
  <!-- Imagen del fondo -->
  <section class="section-fondo img-fondo top">
    <img class="s3_img" src="<%=pieza['imagen_path']%>">
  </section>

  <!-- Titulo y datos básicos -->
  <section class="half-top section-fondo intro-pieza">
    <h2>
      <%=pieza['titulo']%>  
      (<%=pieza['fecha']%>)
    </h2>
    <p class="italic"> 
      <%=creador['nombre']%>  
    </p> 

    <ul class="datos-basicos">
      <li><b> Autoras: </b> <%=pieza['autores']%></li>
      <li><b> Temáticas: </b> <%=pieza['tematicas']%></li>
      <li><b> Técnicas: </b> <%=pieza['tecnicas']%></li>
      <li><b> Materiales: </b><%=pieza['materiales']%></li>
      <li><b> Dimensiones: </b> 
        <%=pieza['ancho']%> x
        <%=pieza['alto']%> x
        <%=pieza['espesor']%>
      </li>
    </ul>
  </section>

  <section class="section-fondo top">
    <div class="row ">
      <div class="col col-12 col-md-6 detalle-piezas" >
        <div class="row sticky-top ">
            <% for(var i = 0; i < descriptores.length; i++) { %>
              <%if (pieza['galeria'][i]) {  %>
                
            <div class="col col-6 detalle detalle-modal">
              <a>
                  <img class="s3_img" src="<%=pieza['galeria'][i]%>">
                
                <div class="blue"></div>
              </a>
            </div>
            <% } %>
            <% } %>
            <ul class="descriptores lista btm">
              <% for(var i = 0; i < descriptores.length; i++) { %>
                <li class="descriptor-li"> <%=descriptores[i]%> </li>
              <% } %>
            </ul>
            <form action="/buscar" method="POST" id="descriptor-form" style="display: none;">
              <input type="text" name="descriptor" id="descriptor-field">
            </form>
        </div>
      </div>
      <script>
        var docDescList = document.getElementsByClassName("descriptor-li");
        var descForm = document.getElementById("descriptor-form");
        var descInput = document.getElementById("descriptor-field");

        var descList = [];

        for (let i = 0; i < docDescList.length; ++i)
        {
          docDescList[i].addEventListener("click", function()
          {
            descInput.value = docDescList[i].innerText.toLowerCase();
            descForm.submit();
          })
        }
      </script>

      <div class="col-12 col-md-6">

        <div id="accordion">
          <!-- relato pieza -->
          <div class="card">
            <div class="card-header" id="headingOne">
              <h5 class="mb-0">
                <button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                  Cómo se hizo
                </button>
              </h5>
            </div>
        
            <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
              <div class="card-body">
                <%=pieza['relato_pieza']%>
              </div>
            </div>
          </div>

          <!-- relato hecho -->
          <div class="card">
            <div class="card-header" id="headingTwo">
              <h5 class="mb-0">
                <button class="btn btn-link" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo">
                  Qué nos cuenta
                </button>
              </h5>
            </div>
        
            <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
              <div class="card-body">
                <ul class="hecho">
                  <li><b> Año: </b> <%=hecho['fecha']%></li>
                  <li><b> Modalidad: </b> <%=hecho['modalidad']%></li>
                  <li><b> Actores: </b> <%=hecho['actores']%></li>
                </ul>
      
                <p>
                  <%=pieza['hecho_relato']%>
                </p>
              </div>
            </div>
          </div>

          <!-- Trayectoria -->
          <div class="card">
            <div class="card-header" id="headingThree">
              <h5 class="mb-0">
                <button class="btn btn-link" data-toggle="collapse" data-target="#collapseThree" aria-expanded="true" aria-controls="collapseTwo">
                  Trayectoría
                </button>
              </h5>
            </div>
        
            <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">
              <div class="card-body">
                <%=pieza['usos']%>
              </div>
            </div>
          </div>

          <!-- Conservación -->
          <div class="card">
            <div class="card-header" id="headingFour">
              <h5 class="mb-0">
                <button class="btn btn-link" data-toggle="collapse" data-target="#collapseFour" aria-expanded="true" aria-controls="collapseFour">
                  Conservación
                </button>
              </h5>
            </div>
        
            <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#accordion">
              <div class="card-body">
                <%=pieza['conservacion']%>
              </div>
            </div>
          </div>

          <!-- Eventos -->
          <div class="card">
            <div class="card-header" id="headingFour">
              <h5 class="mb-0">
                <button class="btn btn-link" data-toggle="collapse" data-target="#collapseFive" aria-expanded="true" aria-controls="collapseFive">
                  Eventos
                </button>
              </h5>
            </div>
        
            <div id="collapseFive" class="collapse" aria-labelledby="headingFive" data-parent="#accordion">
              <div class="card-body">
                <ul>
                  <%var eventos = JSON.parse(pieza['eventos_json'].replace(/(\r\n|\n|\r|')/gm, '"'))['obj']
                  for (let i = 0; i < eventos.length; ++i)
                  {
                    var evento = eventos[i]
                  %>
                  <li> 
                    <p> <%=evento['name']%>,<%=evento['place']%>,<%=evento['date']%> </p>
                  </li>
                  <% } %>
                </ul>
              </div>
            </div>
          </div>

          <!-- Eventos -->
          <div class="card">
            <div class="card-header" id="headingFour">
              <h5 class="mb-0">
                <button class="btn btn-link" data-toggle="collapse" data-target="#collapseSix" aria-expanded="true" aria-controls="collapseSix">
                  Documentos
                </button>
              </h5>
            </div>
        
            <div id="collapseSix" class="collapse" aria-labelledby="headingSix" data-parent="#accordion">
              <div class="card-body">
                <ul>
                  <%var documentos = JSON.parse(pieza['documentos_json'].replace(/(\r\n|\n|\r|')/gm, '"'))['obj']
                  for (let i = 0; i < documentos.length; ++i)
                  {
                    var documento = documentos[i]
                  %>
                  <li> 
                    <a target="_blank" href="<%=documento['url']%>"> <%=documento['name']%></a> </li>
                  </li>
                  <% } %>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
  </section>

  <div class="modal">
    <div class="modal-background"></div>
    <div class="modal-content"></div>   
    <div class="modal-close">Cerrar</div>   
  </div>

</div>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>


<script src="/scripts/s3ImageUrl.js"></script>
<script src="/scripts/modal.js"></script>
<%- include('../partials/footer') -%>
